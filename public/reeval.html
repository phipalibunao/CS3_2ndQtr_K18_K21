<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Your Experience - Fractured Night</title>
<link rel="icon" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png" sizes="any">
<meta name="description" content="Webpage about piecing the story together.">
<meta name="author" content="Phipa Libunao, Datu Macalintal">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/styles/reeval.css">

</head>
<body>

<div id="stormScreen"></div>
<div class="flash" id="flash"></div>

<div id="reflectionCard">
  <h1><span class="typing">Your Investigation..</span></h1>
  <p id="greeting"></p>

  <div id="step1">
    <p>Match the 4 statements that you think explain what really happened with the bridge collapse:</p>
    <div class="matching-container">
      <div class="matching-list" id="choices">
        <h3>Options</h3>
      </div>
      <div class="matching-list" id="selected">
        <h3>Your Selection</h3>
      </div>
    </div>
    <button id="submitThoughts">Reveal the Truth</button>
  </div>

  <div id="step2" style="display:none;">
    <p id="truthStory"></p>
    <p id="score"></p>
    <button onclick="restartStory()">About Us</button>
  </div>
</div>

<script>
const playerName = localStorage.getItem('playerName') || 'Detective';
document.getElementById('greeting').textContent = `Hello, ${playerName}. Can you uncover the truth?`;

statements = [
  "The bridge was sabotaged.",
  "The engineer broke the bridge.",
  "The supervisor kept the bridge unable to be fixed.",
  "The mayor did their job well."
];

const trueStatements = [
  localStorage.getItem("act1") || "x",
  localStorage.getItem("act2") || "x",
  localStorage.getItem("act3") || "x",
  localStorage.getItem("act4") || "x"
];

for (i=0;i<trueStatements.length;i++){
  if (trueStatements[i]!="x"){
    statements.push(trueStatements[i]);
  }
}

cap = 4;

const choicesContainer = document.getElementById('choices');
const selectedContainer = document.getElementById('selected');

statements.forEach(text => {
  const div = document.createElement('div');
  div.className = 'matching-item';
  div.textContent = text;
  div.addEventListener('click', () => {
    if(div.parentElement.id === 'choices'){
      if (cap){
        selectedContainer.appendChild(div);
        cap--
      }
      
    } 
    else{
      choicesContainer.appendChild(div);
      cap++
    } 
  });
  choicesContainer.appendChild(div);
});

document.getElementById('submitThoughts').addEventListener('click', () => {
  const selectedItems = Array.from(selectedContainer.querySelectorAll('.matching-item')).map(e => e.textContent);
  let matches = 0;
  selectedItems.forEach(item => { if(trueStatements.includes(item)) matches++; });
  const accuracy = Math.round((matches / trueStatements.length) * 100);
  localStorage.setItem('score', accuracy);

  const trueStoryText = `The truth:
The bridge was already weak.
The engineer tried to fix the bridge.
The supervisor was protecting the engineer.
The mayor restricted maintenance funds.
Only incomplete stories reached the public, but you might have just pieced out what happened behind the scenes.`;

  document.getElementById('truthStory').textContent = trueStoryText;
  document.getElementById('score').textContent = `Your deduction matched ${accuracy}% of the truth.`;

  document.getElementById('step1').style.display = 'none';
  document.getElementById('step2').style.display = 'block';
});

function restartStory(){ window.location.href='aboutus.html'; }

const storm = document.getElementById('stormScreen');
const flash = document.getElementById('flash');
for(let i=0;i<100;i++){
    const gust = document.createElement('div');
    gust.className = 'wind';
    gust.style.top = Math.random()*100+'vh';
    gust.style.animationDuration = 3 + Math.random()*3+'s';
    gust.style.animationDelay = Math.random()*3+'s';
    gust.style.width = 1 + Math.random()*3+'px';
    gust.style.height = 20 + Math.random()*30+'px';
    storm.appendChild(gust); 
}
setInterval(() => { flash.style.opacity = 0.4; setTimeout(()=>{ flash.style.opacity = 0; }, 150); }, 4000 + Math.random()*3000);
</script>

</body>
</html>
