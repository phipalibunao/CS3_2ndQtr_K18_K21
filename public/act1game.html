<!DOCTYPE html>
<html lang="en">
<head>
    <!-- favicon -->
    <link rel="icon" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png" sizes="any">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png">

    <!-- Encoding + mobile responsiveness -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Page info -->
    <title>Fractured Night â€” Match</title>
    <meta name="description" content="Webpage about the first act's game.">
    <meta name="author" content="Phipa Libunao, Datu Macalintal">
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">

    <!-- Link Stylesheet -->
    <link rel="stylesheet" href="../assets/styles/act1game.css">

</head>
<body>

<h1>Evidence Memory Match</h1>

<div id="summary">
  Match pairs of symbols to uncover evidence. Wrong matches deduct 5 seconds. Time is limited â€” can you find out what really happened before the lie of the public is the only truth?
</div>

<div id="timer">Time Remaining: <span id="time">30</span>s</div>

<div class="rain" id="rain"></div>
<div class="flicker-overlay"></div>

<div id="game"></div>

<div id="hiddenClue"></div>
<button id="nextChapterBtn" onclick="proceedChapter()">Proceed to Chapter 2</button>

<script>
const items = ["ðŸ“","ðŸ“","ðŸ“¸","ðŸ“¸","ðŸ‘¤","ðŸ‘¤","ðŸ“„","ðŸ“„","ðŸ”","ðŸ”","ðŸ•’","ðŸ•’"];
const game = document.getElementById("game");
let flipped = [];
let matched = 0;

function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

shuffle(items).forEach(item => {
  const card = document.createElement("div");
  card.className = "card";
  card.dataset.value = item;
  card.onclick = () => flipCard(card);
  game.appendChild(card);
});

let timeLeft = 30;
const timeEl = document.getElementById("time");
const clueDiv = document.getElementById("hiddenClue");
const nextBtn = document.getElementById("nextChapterBtn");

function flipCard(card){
  if(card.classList.contains("flipped") || flipped.length===2) return;
  card.classList.add("flipped");
  card.textContent = card.dataset.value;
  flipped.push(card);

  if(flipped.length===2){
    if(flipped[0].dataset.value === flipped[1].dataset.value){
      flipped.forEach(c => c.classList.add("matched"));
      matched+=2;
      flipped=[];
      if(matched===items.length){
        endGame(true);
      }
    } else {
      timeLeft = Math.max(0,timeLeft-5);
      flipped.forEach(c => c.classList.add("wrong"));
      setTimeout(()=>{
        flipped.forEach(c=>{c.classList.remove("flipped","wrong"); c.textContent="";});
        flipped=[];
      },700);
    }
  }
}

const timerInterval = setInterval(()=>{
  timeLeft--;
  timeEl.textContent=timeLeft;
  if(timeLeft<=0){
    clearInterval(timerInterval);
    document.querySelectorAll(".card").forEach(c=>c.onclick=null);
    endGame(false);
  }
},1000);

function endGame(won){
  clearInterval(timerInterval); // stop timer immediately
  document.querySelectorAll(".card").forEach(c=>c.onclick=null);
  clueDiv.style.display="block";
  if(won){
    clueDiv.innerHTML="<strong>Hidden Clue Found!</strong><br>The mysterious photo shows the bridge structure already weak. This opens the possibility of the bridge falling of natural causes. You ignored it because a sabotage story was more exciting.";
    localStorage.setItem('act1', 'The bridge was already weak.');
  } else {
    clueDiv.innerHTML="<strong>Time's Up!</strong><br>You couldn't reveal the hidden clue. The story continues with the version the city believes. The shadow figure on the bridge was sabotaging it, and the memo shows the engineer and supervisor guilty.";
  }
  nextBtn.style.display="inline-block";
}

function proceedChapter(){
  window.location.href = "story2.html";
}

function createRain(){
  const rain = document.getElementById("rain");
  for(let i=0;i<150;i++){
    const drop=document.createElement("div");
    drop.className="drop";
    drop.style.left=Math.random()*100+"vw";
    drop.style.animationDuration=0.5+Math.random()*1.5+"s";
    drop.style.opacity=Math.random()*0.4+0.2;
    rain.appendChild(drop);
  }
}
createRain();
</script>

</body>
</html>
