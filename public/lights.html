<!DOCTYPE html>
<html lang="en">
<head>
    <!-- favicon -->
    <link rel="icon" href="https://raw.githubusercontent.com/tomasdmacalintal/CS3_2ndQtrPortfolio/main/assets/images/cspairproj_favicon2.png" sizes="any">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/tomasdmacalintal/CS3_2ndQtrPortfolio/main/assets/images/cspairproj_favicon2.png">

    <!-- Encoding + mobile responsiveness -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Page info -->
    <title>Lights</title>
    <meta name="description" content="The second chapter.">
    <meta name="author" content="Datu Macalintal, Phipa Libunao">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&family=Cormorant+Garamond:wght@600&display=swap" rel="stylesheet">

    <!-- Link Stylesheet -->


    <style>
        .box{
            position: absolute;
            color: white;
            text-shadow: 0 0 3px black, 0 0 3px black, 0 0 3px black, 0 0 3px black;
            user-select: none;
        }
        .box:hover{
            cursor: grab;
        }
        .box:active{
            cursor: grabbing;
        }
        .stretchbox{
            position: absolute;
            transform-origin: left;
            user-select: none;
        }
        .hole{
            position: absolute;
            text-align: right;
            color: white;
            text-shadow: 0 0 3px black, 0 0 3px black, 0 0 3px black, 0 0 3px black;
            user-select: none;
        }
        .container{
            background-color: grey;
            position: absolute;
        }

    </style>
</head>
<body>
    <div class="container" id="container" style="width: 1000px; left: 0px; top: 0px;">
        
    </div>
    

    <script>
        const container = document.getElementById("container");
        const TOTAL = 10;
        const CONTAINER_SPACE = 50;
        const BOX_SPACE = 150;
        const SIDE_LENGTH = "100px";

        holes = [];
        stretchboxes = [];
        boxes = [];
        colors = [];
        
        originalLeft = [];
        originalTop = [];
        boxStays = [];
        correctlyPlaced = [];
        boxSelected = null;
        score = 0;

        for (i = 0; i < TOTAL; i++){
            const hole = document.createElement("div");
            const stretchbox = document.createElement("div");
            const box = document.createElement("div");

            colors.push(i);
            correctlyPlaced.push(false);
            holes.push(hole);
            stretchboxes.push(stretchbox);
            boxes.push(box);
            
            holes[i].classList.add('hole');
            holes[i].style.width = SIDE_LENGTH;
            holes[i].style.height = SIDE_LENGTH;
            holes[i].style.left = `${parseInt(container.style.width) - parseInt(holes[i].style.width)}px`;
            holes[i].style.top = `${(i)*BOX_SPACE + CONTAINER_SPACE}px`;

            stretchboxes[i].classList.add('stretchbox');
            stretchboxes[i].style.width = SIDE_LENGTH;
            stretchboxes[i].style.height = SIDE_LENGTH;
            stretchboxes[i].style.left = "0px";
            stretchboxes[i].style.top = `${(i)*BOX_SPACE + CONTAINER_SPACE}px`;

            boxes[i].classList.add('box');
            boxes[i].id = i;
            boxes[i].style.width = SIDE_LENGTH;
            boxes[i].style.height = SIDE_LENGTH;
            boxes[i].style.left = "0px";
            boxes[i].style.top = `${(i)*BOX_SPACE + CONTAINER_SPACE}px`;
            
            originalLeft[i] = boxes[i].style.left;
            originalTop[i] = boxes[i].style.top;
            boxStays[i] = true;
            boxes[i].addEventListener("mousedown", move);

            container.appendChild(holes[i]);
        }

        for (i = TOTAL; i > 0; i--){
            color = Math.floor(Math.random() * i);
            boxes[TOTAL - i].style.backgroundColor = `rgb(${Math.floor(Math.random() * ((colors[color] + 1) * 60 - 20) + 20)}, ${Math.floor(Math.random() * ((colors[color] + 1) * 40 - 10) + 10)}, ${Math.floor(Math.random() * ((colors[color] + 1) * 50 - 10) + 10)})`;
            boxes[TOTAL - i].innerHTML = TOTAL - i + 1;
            holes[colors[color]].style.backgroundColor = boxes[TOTAL - i].style.backgroundColor;
            holes[colors[color]].innerHTML = boxes[TOTAL - i].innerHTML;
            stretchboxes[TOTAL - i].style.backgroundColor = boxes[TOTAL - i].style.backgroundColor;
            colors.splice(color, 1);

            container.appendChild(stretchboxes[TOTAL - i]);
            container.appendChild(boxes[TOTAL - i]);
        }

        container.style.height = `${parseInt(boxes[TOTAL - 1].style.top) + parseInt(boxes[TOTAL - 1].style.height) + CONTAINER_SPACE}px`;

        function move(event) {
            if (score < TOTAL){
                boxSelected = event.target.id;
                console.log(boxSelected);
                boxStays[boxSelected] = false;
                boxes[boxSelected].style.transition = "none";
                stretchboxes[boxSelected].style.transition = "none";
            }
        }

        document.addEventListener("mousemove", moving);
        function moving(event) {
            if (boxStays[boxSelected] == false){
                if (event.clientX + parseInt(window.scrollX) > parseInt(container.style.left) + parseInt(boxes[boxSelected].style.width)/2 && event.clientX + parseInt(window.scrollX) < parseInt(container.style.left) + parseInt(container.style.width) - parseInt(boxes[boxSelected].style.width)/2)
                    boxes[boxSelected].style.left = `${event.clientX - parseInt(boxes[boxSelected].style.width)/2 - parseInt(container.style.left) + parseInt(window.scrollX)}px`;
                else if (event.clientX + parseInt(window.scrollX) <= parseInt(container.style.left) + parseInt(boxes[boxSelected].style.width)/2)
                    boxes[boxSelected].style.left = 0;
                else
                    boxes[boxSelected].style.left = `${parseInt(container.style.width) - parseInt(boxes[boxSelected].style.width)}px`;
                if (event.clientY + parseInt(window.scrollY) > parseInt(container.style.top) + parseInt(boxes[boxSelected].style.height)/2 && event.clientY + parseInt(window.scrollY) < parseInt(container.style.top) + parseInt(container.style.height) - parseInt(boxes[boxSelected].style.height)/2)
                    boxes[boxSelected].style.top = `${event.clientY - parseInt(boxes[boxSelected].style.height)/2 - parseInt(container.style.top) + parseInt(window.scrollY)}px`;
                else if (event.clientY + parseInt(window.scrollY) <= parseInt(container.style.top) + parseInt(boxes[boxSelected].style.height)/2)
                    boxes[boxSelected].style.top = 0;
                else
                    boxes[boxSelected].style.top = `${parseInt(container.style.height) - parseInt(boxes[boxSelected].style.height)}px`;
                for(i = 0; i < TOTAL; i++){
                    if (event.clientX + parseInt(window.scrollX) >= parseInt(holes[i].style.left) + parseInt(container.style.left) && event.clientX + parseInt(window.scrollX) <= parseInt(holes[i].style.left) + parseInt(holes[i].style.width) + parseInt(container.style.left) && event.clientY + parseInt(window.scrollY) >= parseInt(holes[i].style.top) + parseInt(container.style.top) && event.clientY + parseInt(window.scrollY) <= parseInt(holes[i].style.top) + parseInt(holes[i].style.height) + parseInt(container.style.top)){
                        boxes[boxSelected].style.left = holes[i].style.left;
                        boxes[boxSelected].style.top = holes[i].style.top;
                    }
                } 

                angle = Math.atan2(parseInt(boxes[boxSelected].style.top) - parseInt(originalTop[boxSelected]), parseInt(boxes[boxSelected].style.left) - parseInt(originalLeft[boxSelected]));
                displacement = Math.sqrt((parseInt(originalTop[boxSelected]) - parseInt(boxes[boxSelected].style.top))**2 + (parseInt(boxes[boxSelected].style.left) - parseInt(originalLeft[boxSelected]))**2);

                
                stretchboxes[boxSelected].style.rotate = `${angle}rad`;
                stretchboxes[boxSelected].style.left = `${parseInt(originalLeft[boxSelected]) + parseInt(boxes[boxSelected].style.width)/2}px`;
                boxes[boxSelected].style.rotate = `${angle}rad`;
                stretchboxes[boxSelected].style.width = `${displacement}px`;

                
                
                
            }
        }

        document.addEventListener("mouseup", stay)
        function stay(event) {
            inHole = false;
            for (i = 0; i < TOTAL; i++){
                if (event.clientX + parseInt(window.scrollX) < parseInt(holes[i].style.left) + parseInt(container.style.left) || event.clientX + parseInt(window.scrollX) > parseInt(holes[i].style.left) + parseInt(holes[i].style.width) + parseInt(container.style.left) || event.clientY + parseInt(window.scrollY) < parseInt(holes[i].style.top) + parseInt(container.style.top) || event.clientY + parseInt(window.scrollY) > parseInt(holes[i].style.top) + parseInt(holes[i].style.height) + parseInt(container.style.top)){
                    if (boxSelected != null){
                        if (correctlyPlaced[i] == true && boxes[boxSelected].style.backgroundColor == holes[i].style.backgroundColor){
                            score = score - 1;
                            correctlyPlaced[i] = false;
                        }
                    }
                }
                else{
                    if (boxSelected != null){
                        inHole = true;
                        if (boxes[boxSelected].style.backgroundColor == holes[i].style.backgroundColor){
                            if (correctlyPlaced[i] == false){
                                score = score + 1;
                                correctlyPlaced[i] = true;
                            }
                            
                        }
                    }
                }
            }
            if (inHole == false){
                if (boxStays[boxSelected] == false){
                    stretchboxes[boxSelected].style.transition = "ease-out 0.5s";
                    stretchboxes[boxSelected].style.width = "0px";
                    boxes[boxSelected].style.left = originalLeft[boxSelected];
                    boxes[boxSelected].style.top = originalTop[boxSelected];
                    boxes[boxSelected].style.transition = "ease-out 0.5s";
                }
            }

            if (score == TOTAL && boxSelected != null){
                console.log("Hooray!");
                for (i = 0; i < TOTAL; i++){
                    boxes[i].style.cursor = "default";
                }
            }

            boxStays[boxSelected] = true;
            boxSelected = null;
            console.log(score);
        }
    </script>
</body>