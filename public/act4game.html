<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png" sizes="any">
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fractured Night â€” Budget Allocation</title>
<meta name="description" content="Webpage about the fourth act's game.">
<meta name="author" content="Phipa Libunao, Datu Macalintal">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/styles/act4game.css">

</head>
<body>

<div class="navbar">
  <a href="homepage.html">Home</a>
  <a href="story1.html">Act 1</a>
  <a href="story2.html">Act 2</a>
  <a href="story3.html">Act 3</a>
  <a href="story4.html">Act 4</a>
  <a href="aboutus.html">About Us</a>
</div>

<div class="wrap">
<h1>Act 4: Public Duty</h1>
<p class="lead">Drag the budgets to the correct project. Each project has 2 budgets.<br><span style="color:var(--highlight);">Every wrong move = -5 seconds.</span></p>
<h2 id="timer">85</h2>

<div class="rain" id="rain"></div>

<div class="game-area">
<div class="card-scene">

<div id="projects">
  <div class="project" data-accept="maintenance">Bridge Maintenance</div>
  <div class="project" data-accept="reputation">City Reputation</div>
  <div class="project" data-accept="parks">Parks & Culture</div>
  <div class="project" data-accept="personal">Mayorâ€™s Personal Project</div>
</div>

<div id="game">
  <div class="budget-item" draggable="true" data-type="reputation" data-budget="ðŸ’° $45k">ðŸ’° $45k</div>
  <div class="budget-item" draggable="true" data-type="maintenance" data-budget="ðŸ’° $10k">ðŸ’° $10k</div>
  <div class="budget-item" draggable="true" data-type="personal" data-budget="ðŸ’° $180k">ðŸ’° $180k</div>
  <div class="budget-item" draggable="true" data-type="parks" data-budget="ðŸ’° $50k">ðŸ’° $50k</div>
  <div class="budget-item" draggable="true" data-type="personal" data-budget="ðŸ’° $120k">ðŸ’° $120k</div>
  <div class="budget-item" draggable="true" data-type="maintenance" data-budget="ðŸ’° $5k">ðŸ’° $5k</div>
  <div class="budget-item" draggable="true" data-type="parks" data-budget="ðŸ’° $30k">ðŸ’° $30k</div>
  <div class="budget-item" draggable="true" data-type="reputation" data-budget="ðŸ’° $60k">ðŸ’° $60k</div>
</div>

<div id="hiddenClue"></div>
<div id="gameOver">GAME OVER. Please wait for your reflection.</div>

</div>

<div id="clues">
<h3>Clues</h3>
<ul>
<li>Bridge Maintenance has the lowest budget allocation.</li>
<li>City Reputation: One budget divided by 1000 is an odd number, and the 2 budgets' LCM is 180k.</li>
<li>Parks & Culture: Their sum multiplied by 3 is equal to 240k</li>
<li>The Mayorâ€™s Personal Project has the largest allocations.</li>
</ul>
<p>Use these hints to deduce the correct budget allocation.</p>
</div>

</div>
</div>

<script>
const items = document.querySelectorAll('.budget-item');
const projects = document.querySelectorAll('.project');
let timeLeft = 85;
const timerDisplay = document.getElementById("timer");
const hiddenClue = document.getElementById("hiddenClue");
const gameOver = document.getElementById("gameOver");
let gameEnded = false;

const countdown = setInterval(() => {
  timeLeft--;
  timerDisplay.textContent = timeLeft;
  if(timeLeft <= 10 && timeLeft > 0) timerDisplay.classList.add("warning");
  if(timeLeft <= 0 && !gameEnded){
    endGame(false);
  }
}, 1000);

items.forEach(item => {
  item.addEventListener('dragstart', e => {
    e.dataTransfer.setData('type', item.dataset.type);
    e.dataTransfer.setData('text', item.dataset.budget);
    item.classList.add('dragging');
  });
  item.addEventListener('dragend', () => item.classList.remove('dragging'));
});

projects.forEach(proj => {
  proj.addEventListener('dragover', e => e.preventDefault());
  proj.addEventListener('drop', e => {
    e.preventDefault();
    const type = e.dataTransfer.getData('type');
    const draggedItem = [...items].find(i => i.innerHTML === e.dataTransfer.getData('text'));
    if(proj.dataset.accept === type){
      draggedItem.classList.add('correct');
      draggedItem.setAttribute('draggable', false);
      if([...items].filter(i => i.dataset.type !== 'fake').every(i => i.classList.contains('correct'))){
        endGame(true);
      }
    } else {
      draggedItem.classList.add('wrong');
      setTimeout(()=>draggedItem.classList.remove('wrong'), 300);
      timeLeft -= 5;
    }
  });
});

function endGame(won){
  gameEnded = true;
  clearInterval(countdown);
  items.forEach(i => i.setAttribute('draggable', false));
  hiddenClue.style.display = 'block';
  gameOver.style.display = 'block';
  if(won){
    hiddenClue.innerHTML = "Hidden Clue Found: Did you notice? Maintenance budget was the lowest out of all. You could not let the engineer and supervisor voice out their opinions about you. In the end, you restricted the budget, kept your reputation, and took most of the budget all for yourself.";
    localStorage.setItem('act4', 'The mayor restricted maintenance funds.');
  } else {
    hiddenClue.innerHTML = "You weren't able to find the hidden clue. The story remains the same. You called for maintenance and managed the budget well.";
  }
  setTimeout(()=>{window.location.href='reeval.html';},5000);
}

function shuffleBudgets(){
  const game = document.getElementById('game');
  for(let i=game.children.length;i>=0;i--){
    game.appendChild(game.children[Math.random()*i|0]);
  }
}
setInterval(shuffleBudgets,10000);

function createRain(){
  const rain = document.getElementById("rain");
  for(let i=0;i<150;i++){
    const drop = document.createElement("div");
    drop.className="drop";
    drop.style.left = Math.random()*100+"vw";
    drop.style.animationDuration = 0.4 + Math.random()*1.2 + "s";
    drop.style.opacity = Math.random();
    rain.appendChild(drop);
  }
}
createRain();
</script>

</body>
</html>
