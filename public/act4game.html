<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png" sizes="any">
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fractured Night â€” Budget Allocation</title>
<meta name="description" content="Webpage about the fourth act's game.">
<meta name="author" content="Phipa Libunao, Datu Macalintal">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0b0f;
  --card1:#1c1c23;
  --card2:#262630;
  --accent:#e6e6e6;
  --nav:#14141a;
  --nav-hover:#f7d678;
  --highlight:#f7d678;
}
html,body{
  margin:0;
  padding:0;
  font-family:'Special Elite', monospace;
  background:var(--bg);
  color:var(--accent);
  overflow-y:auto;
}
.navbar{
  width:100%;
  background:var(--nav);
  padding:12px 0;
  display:flex;
  justify-content:center;
  gap:24px;
  position:sticky;
  top:0;
  z-index:100;
}
.navbar a{
  color:var(--accent);
  text-decoration:none;
  font-weight:bold;
  transition:.2s;
}
.navbar a:hover{color:var(--nav-hover);}
.wrap{
  width:100%;
  min-height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:30px;
  box-sizing:border-box;
  text-align:center;
}
h1{
  color:var(--highlight);
  margin-bottom:5px;
  font-size:36px;
}
.lead{
  opacity:.9;
  max-width:900px;
  line-height:1.6;
}
#timer{
  font-size:28px;
  color:var(--highlight);
  margin-bottom:20px;
  font-weight:bold;
}
.warning{color:#ff4d4d!important;}
.game-area{
  display:flex;
  gap:20px;
  width:100%;
  max-width:1200px;
}
.card-scene{
  flex:3;
  background:linear-gradient(135deg,var(--card1),var(--card2));
  padding:25px;
  border-radius:16px;
  box-shadow:0 0 20px rgba(0,0,0,0.5);
  transition:0.3s;
}
#projects{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
  margin-top:20px;
}
.project{
  border:2px dashed #888;
  border-radius:12px;
  height:130px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  padding:10px;
  transition:.2s;
}
.project:hover{border-color:var(--highlight);}
#game{
  margin-top:25px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:15px;
}
.budget-item{
  background:linear-gradient(135deg,var(--card1),var(--card2));
  border-radius:12px;
  padding:15px;
  font-size:22px;
  cursor:grab;
  user-select:none;
  text-align:center;
  transition:.3s;
  border:1px solid rgba(255,255,255,0.1);
}
.budget-item:hover{
  box-shadow:0 0 12px rgba(247,214,120,0.6);
  transform:scale(1.1);
}
.budget-item.dragging{
  opacity:0.5;
  transform:scale(1.1);
}
.budget-item.correct{
  background: #f7d678;
  color: #000;
  box-shadow:0 0 12px #f7d678;
  cursor: default;
}
.budget-item.wrong{
  animation:shake 0.3s;
}
@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-5px);}
  50%{transform:translateX(5px);}
  75%{transform:translateX(-5px);}
  100%{transform:translateX(0);}
}
#hiddenClue{
  margin-top:25px;
  padding:20px;
  background:rgba(255,255,255,0.05);
  border-radius:12px;
  font-size:20px;
  color:var(--highlight);
  font-weight:bold;
}
#gameOver{
  margin-top:30px;
  font-size:24px;
  font-weight:bold;
  color:#f7d678;
  display:none;
}
#clues{
  flex:1;
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:12px;
  text-align:left;
  font-size:18px;
  line-height:1.5;
  color:var(--highlight);
}
.rain{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  overflow:hidden;
}
.drop{
  position:absolute;
  width:2px;
  height:15px;
  background:rgba(255,255,255,0.5);
  animation:fall linear infinite;
}
@keyframes fall{
  0%{transform:translateY(-20px);}
  100%{transform:translateY(120vh);}
}
</style>
</head>
<body>

<div class="navbar">
  <a href="homepage.html">Home</a>
  <a href="story1.html">Act 1</a>
  <a href="story2.html">Act 2</a>
  <a href="story3.html">Act 3</a>
  <a href="story4.html">Act 4</a>
  <a href="aboutus.html">About Us</a>
</div>

<div class="wrap">
<h1>Act 4: Public Duty</h1>
<p class="lead">Drag the budgets to the correct project.<br><span style="color:var(--highlight);">Every wrong move = -5 seconds.</span></p>
<h2 id="timer">85</h2>

<div class="rain" id="rain"></div>

<div class="game-area">
<div class="card-scene">

<div id="projects">
  <div class="project" data-accept="maintenance">Bridge Maintenance</div>
  <div class="project" data-accept="reputation">City Reputation</div>
  <div class="project" data-accept="parks">Parks & Culture</div>
  <div class="project" data-accept="personal">Mayorâ€™s Personal Project</div>
</div>

<div id="game">
  <div class="budget-item" draggable="true" data-type="reputation">ðŸ’° $45k</div>
  <div class="budget-item" draggable="true" data-type="maintenance">ðŸ’° $50k</div>
  <div class="budget-item" draggable="true" data-type="parks">ðŸ’° $35k</div>
  <div class="budget-item" draggable="true" data-type="reputation">ðŸ’° $10k</div>
  <div class="budget-item" draggable="true" data-type="personal">ðŸ’° $120k</div>
  <div class="budget-item" draggable="true" data-type="maintenance">ðŸ’° $30k</div>
  <div class="budget-item" draggable="true" data-type="fake">ðŸ’° $5k</div>
  <div class="budget-item" draggable="true" data-type="fake">ðŸ’° $60k</div>
</div>

<div id="hiddenClue"></div>
<div id="gameOver">GAME OVER</div>

</div>

<div id="clues">
<h3>Clues</h3>
<ul>
<li>Bridge Maintenance is substantial but not the highest budget.</li>
<li>City Reputation is smaller but important for appearances.</li>
<li>Parks & Culture is moderate, smaller than the bridge budget.</li>
<li>The Mayorâ€™s Personal Project is the largest allocation.</li>
</ul>
<p>Use these hints to deduce the correct budget allocation.</p>
</div>

</div>
</div>

<script>
const items = document.querySelectorAll('.budget-item');
const projects = document.querySelectorAll('.project');
let timeLeft = 85;
const timerDisplay = document.getElementById("timer");
const hiddenClue = document.getElementById("hiddenClue");
const gameOver = document.getElementById("gameOver");
let gameEnded = false;

const countdown = setInterval(() => {
  timeLeft--;
  timerDisplay.textContent = timeLeft;
  if(timeLeft <= 10 && timeLeft > 0) timerDisplay.classList.add("warning");
  if(timeLeft <= 0 && !gameEnded){
    endGame(false);
  }
}, 1000);

items.forEach(item => {
  item.addEventListener('dragstart', e => {
    e.dataTransfer.setData('type', item.dataset.type);
    e.dataTransfer.setData('id', item.innerHTML);
    item.classList.add('dragging');
  });
  item.addEventListener('dragend', () => item.classList.remove('dragging'));
});

projects.forEach(proj => {
  proj.addEventListener('dragover', e => e.preventDefault());
  proj.addEventListener('drop', e => {
    e.preventDefault();
    const type = e.dataTransfer.getData('type');
    const draggedItem = [...items].find(i => i.innerHTML === e.dataTransfer.getData('id'));
    if(proj.dataset.accept === type && type !== "fake"){
      draggedItem.classList.add('correct');
      draggedItem.setAttribute('draggable', false);
      if([...items].filter(i => i.dataset.type !== 'fake').every(i => i.classList.contains('correct'))){
        endGame(true);
      }
    } else {
      draggedItem.classList.add('wrong');
      setTimeout(()=>draggedItem.classList.remove('wrong'), 300);
      timeLeft -= 5;
    }
  });
});

function endGame(won){
  gameEnded = true;
  clearInterval(countdown);
  items.forEach(i => i.setAttribute('draggable', false));
  hiddenClue.style.display = 'block';
  gameOver.style.display = 'block';
  if(won){
    hiddenClue.innerHTML = "**True Clue:** The mayor cut the budget to other projects, kept his reputation, and took the budget all for himself.";
    localStorage.setItem('act4', 'The mayor restricted maintenance funds.');
  } else {
    hiddenClue.innerHTML = "You weren't able to find the hidden clue. The story remains the same. The mayor did maintenance and managed the budget.";
  }
  setTimeout(()=>{window.location.href='reeval.html';},5000);
}

function shuffleBudgets(){
  const game = document.getElementById('game');
  for(let i=game.children.length;i>=0;i--){
    game.appendChild(game.children[Math.random()*i|0]);
  }
}
setInterval(shuffleBudgets,10000);

function createRain(){
  const rain = document.getElementById("rain");
  for(let i=0;i<150;i++){
    const drop = document.createElement("div");
    drop.className="drop";
    drop.style.left = Math.random()*100+"vw";
    drop.style.animationDuration = 0.4 + Math.random()*1.2 + "s";
    drop.style.opacity = Math.random();
    rain.appendChild(drop);
  }
}
createRain();
</script>

</body>
</html>
