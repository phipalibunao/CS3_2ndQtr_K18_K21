<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png" sizes="any">
<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/phipalibunao/CS3_2ndQtr_K18_K21/main/assets/cspairproj_favicon2.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fractured Night ‚Äî Silent Night</title>
<meta name="description" content="Webpage telling the story of the second act.">
<meta name="author" content="Phipa Libunao, Datu Macalintal">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/styles/story2.css">

</head>
<body>
<div id="grain"></div>

<!-- PLAYER TAG -->
<div id="playerTag"></div>

<div class="navbar">
  <a href="homepage.html">Home</a>
  <a href="story1.html">Act 1</a>
  <a href="story2.html">Act 2</a>
  <a href="story3.html">Act 3</a>
  <a href="story4.html">Act 4</a>
  <a href="aboutus.html">About Us</a>
</div>

<div class="wrap">
<header>
  <h1>Chapter 2: Silent Night</h1>
  <div class="pov-sign">POV: Engineer</div>
  <p class="lead">This is your interrogation record. Try to answer for your freedom, or let the public narrative stand.</p>
</header>
<div class="scene">
  <div class="card-scene">
    <div class="description">The broken bridge creaks in the storm. Cameras watch. The transcript records your words. This does not look good for you. In fact, you ARE the person at the bridge before the collapse.</div>
    <div class="hotspots" id="hotspots">
      <div class="hotspot" data-id="1">üîå<br>Question 1</div>
      <div class="hotspot" data-id="2">üõ†Ô∏è<br>Question 2</div>
      <div class="hotspot" data-id="3">üîç<br>Question 3</div>
    </div>
    <div class="transcript" id="transcript">
      <div class="timestamp" id="tsTop"></div>
      <div id="lines">
        <div class="line">[SYSTEM] Camera feed active. Recording initiated.</div>
      </div>
    </div>
    <div class="controls">
      <div id="riddleArea"></div>
      <button class="btn primary" id="finishBtn" disabled>Finish Shift</button>
      <div style="flex:1"></div>
      <div id="status">Actions Recorded: <strong id="count">0</strong></div>
    </div>
    <div class="outcome" id="publicStory"></div>
  </div>
  <aside class="inventory">
    <div class="inv-title">Recorded Actions</div>
    <div id="inventoryList"><div class="inv-empty">Nothing yet.</div></div>
  </aside>
</div>
</div>

<div class="cctv-overlay"></div>
<div class="screen-overlay" id="screenOverlay"></div>
<div class="flash-red" id="flashRed"></div>
<div class="cctv-ticker" id="ticker"></div>

<script>
const playerTag = document.getElementById("playerTag");
const playerName = localStorage.getItem("playerName") || "Guest";
playerTag.textContent = `Player: ${playerName}`;

let inventory=[];
const invList=document.getElementById("inventoryList");
const countEl=document.getElementById("count");
const transcript=document.getElementById("transcript");
const linesEl=document.getElementById("lines");
const tsTop=document.getElementById("tsTop");
const riddleArea=document.getElementById("riddleArea");
const finishBtn=document.getElementById("finishBtn");
const screenOverlay=document.getElementById("screenOverlay");
const flashRed=document.getElementById("flashRed");
const ticker=document.getElementById("ticker");

const questions = {
  1: "Officer: Why were you at the bridge during the night of the incident?",
  2: "Officer: Multiple witnesses claim you were touching the wiring. What exactly were you doing?",
  3: "Officer: Why did you leave the bridge quickly when the patrol arrived?"
};

function nowStamp(){
  const d=new Date();
  const pad=(n)=>n.toString().padStart(2,'0');
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
}
function updateTimestamps(){
  tsTop.textContent = 'REC: ' + nowStamp();
  ticker.textContent = 'CAM 03 | ' + nowStamp();
}
setInterval(updateTimestamps,1000);
updateTimestamps();

function refreshInv(){
  invList.innerHTML="";
  if(inventory.length===0){
    let e=document.createElement("div");
    e.className="inv-empty";
    e.textContent="Nothing yet.";
    invList.appendChild(e);
  }else{
    inventory.forEach(i=>{
      let box=document.createElement("div");
      box.className="action-card";
      box.textContent=i.label;
      invList.appendChild(box);
      setTimeout(()=>{box.classList.add('show')},50);
    });
  }
  countEl.textContent=inventory.length;
  finishBtn.disabled = inventory.length < 3;
}

function typeLine(text,cb){
  const container=document.createElement('div');
  container.className='line';
  linesEl.appendChild(container);
  let i=0;
  const t=setInterval(()=>{
    container.textContent = text.slice(0,i+1);
    i++;
    transcript.scrollTop = transcript.scrollHeight;
    if(i>=text.length){clearInterval(t);if(cb)cb();}
  },15);
}

function showQuestion(id){
  riddleArea.innerHTML = `<div style="color:var(--cctv-green);font-family:monospace;margin-top:8px">${questions[id]}</div><div class="input-row"><input type="text" id="answerInput" placeholder="Your response"><button class="btn" id="submitAnswer">Submit</button></div>`;
  document.getElementById("submitAnswer").onclick = () => {
    let user = document.getElementById("answerInput").value.trim();
    if(user.length>0){
      const entry = `${nowStamp()} | ENGINEER: ${user}`;
      typeLine(entry);
      addItem(id, questions[id] + " ‚Äî " + user);
      riddleArea.innerHTML = '';
      screenPulse();
    }
  };
}

function addItem(id,label){
  if(inventory.some(x=>x.id===id)) return;
  inventory.push({id,label});
  refreshInv();
}

document.querySelectorAll(".hotspot").forEach(h=>{h.onclick=()=> {if (countEl.innerHTML == parseInt(h.dataset.id) - 1){showQuestion(h.dataset.id);}}});

finishBtn.onclick = () => {
  screenOverlay.style.background = 'rgba(0,0,0,0.6)';
  screenOverlay.style.opacity = '1';
  flashRed.style.transition = 'opacity .12s';
  flashRed.style.opacity = '1';
  setTimeout(()=>{flashRed.style.opacity='0'},350);
  setTimeout(()=>{screenOverlay.style.opacity='0'; window.location.href='act2game.html'},800);
};

function screenPulse(){
  screenOverlay.style.background = 'rgba(255,0,0,0.02)';
  screenOverlay.style.opacity = '1';
  setTimeout(()=>{screenOverlay.style.opacity='0'},240);
}
</script>
</body>
</html>
